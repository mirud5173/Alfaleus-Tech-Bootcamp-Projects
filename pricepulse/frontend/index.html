<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/static/styles.css" />
  <meta charset="UTF-8" />
  <title>PricePulse - E-Commerce Price Tracker</title>
</head>
<body>
  <div class="container">
    <h1>PricePulse - E-Commerce Price Tracker</h1>

    <form id="track-form">
      <label for="url">Enter Amazon Product URL:</label>
      <div class="form-row">
        <input type="url" id="url" placeholder="https://www.amazon.in/dp/..." required />
        <button type="submit">Track</button>
      </div>
    </form>

    <div class="section">
      <h2>Product Preview:</h2>
      <div class="product-preview">
        <div class="image-box"></div>
        <div class="product-details">
          <strong id="product-title">[Title will appear here]</strong><br />
          <span id="product-price">Current Price: ₹--</span>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Price History Graph:</h2>
      <div class="graph-box">[Graph Placeholder]</div>
    </div>

    <div class="section">
      <h2>Available on Other Platforms:</h2>
      <div class="platform-box">
        <p>- Flipkart: ₹13,299</p>
        <p>- Meesho: ₹13,499</p>
        <p>- BigBasket: Not Available</p>
      </div>
    </div>
  </div>
  <script>
  const form = document.getElementById('track-form');

  form.addEventListener('submit', async (e) => {
  e.preventDefault(); // prevent page reload

  const urlInput = document.getElementById('url');
  const url = urlInput.value;

  // Send URL to backend /scrape endpoint
  const response = await fetch('/scrape', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ url })
  });

  const data = await response.json();
  console.log("Scrape result:", data);

  // Update page with scraped product info
  if (data.title && data.price) {
    document.getElementById('product-title').textContent = data.title;
    document.getElementById('product-price').textContent = `Current Price: ${data.price}`;
  } else if (data.error) {
    alert("Failed to scrape product: " + data.error);
  } else {
    alert("Unexpected response from server.");
  }
  });
  </script>

</body>
</html>
